---
title: "Algorithmik & Statistik Lab 2: Analyse Proposal"
author: "Lara Knapwost - 1810837601, Cornelia Reithmeier - 1810837362, Isabelle Veitl - 1810837521, Anna Weber - 1810837818"
date: '30.März 2019'
output: html_document
urlcolor: cyan
---
***

## Datensatz
Für die Gruppenarbeit werden Daten von Kaggle verwendet:  
https://www.kaggle.com/aaronschlegel/austin-animal-center-shelter-intakes-and-outcomes#aac_intakes.csv

Von den dort gesammelten Daten wird folgende Datei verwendet: `aac_intakes_outcomes`

Der Datensatz enthält unter anderem folgende Variablen:

* animal_id - eindeutige ID des Tieres
* age_upon_outcome - Alter des Tieres bei Outcome
* date_of_birth - Geburtsdatum des Tieres (geschätzt, wenn dieses nicht bekannt war)
* outcome_subtype - spezifische Beschreibung des Outcomes
* outcome_type - Art des Outcomes
* datetime - Datum und Uhrzeit des Outcomes
* outcome_number - Anzahl, wie oft ein Tier das Tierheim schon verlassen hat
* sex_upon_outcome - Geschlecht des Tieres und ob das Tier kastriert wurde
* age_upon_intake - Alter des Tieres bei Aufnahme in String-Format 
* animal_type - Tierart
* breed - Tierrasse
* color - Tierfarbe
* datetime - Datum und Uhrzeit der Aufnahme
* found_location - Adresse oder Bereich, wo das Tier gefunden wurde 
* intake_condition - Zustand des Tieres bei der Aufnahme
* intake_type - kategorisierter Aufnahmetyp
* name - Name des Tieres
* sex_upon_intake - Geschlecht des Tieres und ob das Tier kastriert wurde
* intake_number - Anzahl, wie oft ein Tier schon zum Tierheim gebracht wurde
* time_in_shelter - Zeit im Tierheim

Neben diesen Variablen existierten weitere Variablen, die beispielsweise Zeiträume in einem anderen Format darstellen.

## Hintergrundinformationen zum Datensatsz
Die Daten wurden vom Austin Animal Center erhoben. Dieses Animal Center ist das größte Tierheim in den USA, in dem keine Tiere getötet werden und kann bis zu 18.000 Tiere pro Jahr aufnehmen. Es werden alle Arten von Tieren aufgenommen. Das Tierheim befindet sich im Travis County im US-Bundesstaat Texas.
Die Daten werden im Rahmen der Austin's Open Data Intitiative online bereitgestellt.  

Der Datensatz enthält n = 79.672 Observationen und 41 Variablen.   
Die Daten stammen aus der Zeit zwischen Oktober 2013 bis April 2018 (Outcomes).  
Die Tiere sind zwischen 0-25 Jahre alt, der Median liegt bei 1 Jahr, die Geschlechtsverteilung männlicher und weiblicher Tiere liegt fast bei 50/50.  
Mehr als die Hälfte der Tiere sind Hunde, gefolgt von Katzen und einigen Vögeln (<500). Etwa 4.500 Tiere sind keiner Spezies zugeordnet.   
Knapp die Hälfte der im Datensatz enthaltenen Tiere wurde adoptiert.   

## Statistische Lernaufgabe
Im Rahmen der Gruppenarbeit soll folgendes Klassifikationsproblem betrachtet werden:

Vorhersage des Outcome-Types auf Basis der gegebenen Variablen. Es sollen die Prädiktoren gefunden werden, anhand derer

* eine Rückgabe an den Besitzer, 
* ein Transfer oder 
* eine Adaption 
möglichst genau vorhergesagt werden kann. 

## Motivation
Es gibt viele Tierheime durch Hörensagen ist bekannt, dass in vielen davon eine Großzahl der Tiere einen beträchtlichen Teil ihres Lebens verbringen. 
Es ist interessant für uns, herauszufinden, welche Aspekte ausschlaggebend dafür sind, ob das Tier (vor dem Tod) wieder aus dem Tierheim "entlassen" wird, d.h. einen neuen Besitzer findet. Wir haben einige Hypothesen, welche wir prüfen möchten. Wir gehen davon aus, dass vor allem jüngere, gesunde Tiere eine bessere Chance haben, als ältere, kranke, ggf. auch nicht kastrierte (Streuner-)Tiere, die bereits sehr lange im Tierheim sind.   
Weiß man, welche Aspekte eine Rolle spielen, könnte man diese gezielt in den Tierheimen in der Kommunikation verwenden, um mehr Tieren ein neues zu Hause zu geben.   
Wir haben uns für diesen Datensatz mit dieser Fragestellung entschieden, da einige von uns selbst Haustiere besitzen und wir den Eindruck haben, dass es bereits ausreichend viele Analysen zu ökonomischen Fragestellungen gibt.

## Vorbereitung in R
Nachweis, dass die Daten in R geladen werden können. Laden Sie die Daten und drucken Sie die ersten Werte der Antwortvariablen als Nachweis. Warum diese Daten?
Nachweis, dass die Daten in R modelliert werden können. Passen Sie entweder lm() (Regression) oder glm() (Klassifizierung) an, rufen Sie dann predict() auf und geben Sie die ersten Werte zurück. Möglicherweise müssen Sie vor diesem Schritt eine Datenbereinigung durchführen.

```{r, include=F}
library("plyr")
library("anytime")
library("lubridate")
```

```{r}
aac_intakes_outcomes = read.csv("aac_intakes_outcomes.csv")
```

```{r}
str(aac_intakes_outcomes)
head(aac_intakes_outcomes)
```

```{r}
summary(aac_intakes_outcomes)
```

```{r}
aac_intakes_outcomes$animal_id_outcome <- as.character(aac_intakes_outcomes$animal_id_outcome)
aac_intakes_outcomes$date_of_birth <- anytime(aac_intakes_outcomes$date_of_birth)

aac_intakes_outcomes$sex_upon_outcome_first <- as.factor(sapply(strsplit(as.character(aac_intakes_outcomes$sex_upon_outcome), " "), "[", 1))
aac_intakes_outcomes$sex_upon_outcome_second <- sapply(strsplit(as.character(aac_intakes_outcomes$sex_upon_outcome), " "), "[", 2)
aac_intakes_outcomes$sex_upon_outcome_second[is.na(aac_intakes_outcomes$sex_upon_outcome_second)] <- "Unknown"
aac_intakes_outcomes$sex_upon_outcome_second <- as.factor(aac_intakes_outcomes$sex_upon_outcome_second)

aac_intakes_outcomes$age_upon_outcome_.days. <- as.numeric(aac_intakes_outcomes$age_upon_outcome_.days.)
aac_intakes_outcomes$outcome_datetime <- anytime(aac_intakes_outcomes$outcome_datetime)
aac_intakes_outcomes$outcome_month <- as.factor(aac_intakes_outcomes$outcome_month)
aac_intakes_outcomes$outcome_year <- as.factor(aac_intakes_outcomes$outcome_year)
aac_intakes_outcomes$outcome_hour <- as.factor(hour(aac_intakes_outcomes$outcome_datetime))
aac_intakes_outcomes$dob_month <- as.factor(aac_intakes_outcomes$dob_month)
aac_intakes_outcomes$dob_year <- as.factor(aac_intakes_outcomes$dob_year)
aac_intakes_outcomes$animal_id_intake <- as.character(aac_intakes_outcomes$animal_id_intake)

aac_intakes_outcomes$sex_upon_intake_first <- as.factor(sapply(strsplit(as.character(aac_intakes_outcomes$sex_upon_intake), " "), "[", 1))
aac_intakes_outcomes$sex_upon_intake_second <- sapply(strsplit(as.character(aac_intakes_outcomes$sex_upon_intake), " "), "[", 2)
aac_intakes_outcomes$sex_upon_intake_second[is.na(aac_intakes_outcomes$sex_upon_intake_second)] <- "Unknown"
aac_intakes_outcomes$sex_upon_intake_second <- as.factor(aac_intakes_outcomes$sex_upon_intake_second)

aac_intakes_outcomes$count <- as.numeric(aac_intakes_outcomes$count)
aac_intakes_outcomes$age_upon_intake_.days. <- as.numeric(aac_intakes_outcomes$age_upon_intake_.days.)
aac_intakes_outcomes$intake_datetime <- anytime(aac_intakes_outcomes$intake_datetime)
aac_intakes_outcomes$intake_month <- as.factor(aac_intakes_outcomes$intake_month)
aac_intakes_outcomes$intake_year <- as.factor(aac_intakes_outcomes$intake_year)
aac_intakes_outcomes$intake_hour <- as.factor(hour(aac_intakes_outcomes$intake_datetime))
```

Anmerkungen zu dem Datenset:

* NAs entfernen
* Variablen mit Uhrzeit erscheinen nicht richtig
* age_group muss überprüft werden, machen diese Stufen sinn, warum ist ein negativer Wert enthalten?
* sollten Datensätze gelöscht werden, bei denen das Intake-Datum vor dem Geburtsdatum liegt?
* tiere aus verschiedenen arten sind unterschiedlich alt
* leere Werte aus Outcome Type l?schen
* folgende Tiere gibt es - bei "Other" ist im Breed Info enthalten --> eine gemeinsame Spalte erstellen 



```{r}
table(aac_intakes_outcomes$animal_type)
```

* aus gemischten color --> multicolor
* age upon intake = 0 --> nachrechnen
* aus kastriert und sterilisiert eine zeile machen - wie gehen wir mit infos um, bei denen kastration beim intake war und intact beim outcome --> unknown

```{r}
table(aac_intakes_outcomes2$sex_upon_intake_first, aac_intakes_outcomes2$sex_upon_outcome_first) 

```


```{r}
aac_intakes_outcomes2 <- aac_intakes_outcomes[c(5, 4, 22:27, 43, 45, 42, 44, 3, 17, 18, 33:35, 37, 39, 10:12, 14, 16, 20, 30, 31, 32, 1, 7, 8, 9, 40, 41)]
```

Folgende Variablen wurden für das neue Dataset nicht verwendet:

* found_location - keine gute Datenqualit?t, nicht immer gleiche Daten erfasst
* sex_open_intake raus, da gleich wie outcome

```{r}
table(aac_intakes_outcomes2$sex_upon_intake_second, aac_intakes_outcomes2$sex_upon_outcome_second)
```


* outcome_subtype - keine gute Datenqualit?t - siehe crosstab

table(aac_intakes_outcomes$outcome_type, aac_intakes_outcomes$outcome_subtype)

* animal_id_outcome - ID kann nicht für Klassifikation verwendet werden
* sex_upon_outcome - wurde gesplittet, neue Variablen werden verwendet
* outcome_monthyear - der Monat und das Jahr als einzelne Variablen werden verwendet
* outcome_hour - Stunde erscheint wenig sinnvoll, da auch zu ungewöhnichen Uhrzeiten Geschäftsfälle registriert werden
* dob_monthyear - Geburstdatum wird verwendet
* animal_id_intake - ID kann nicht für Klassifikation verwendet werden
* sex_upon_intake - wurde gesplittet, neue Variablen werden verwendet
* count - alle Werte sind 1, Aushilfsspalte
* intake_monthyear - der Monat und das Jahr als einzelne Variablen werden verwendet
* intake_hour - Stunde erscheint wenig sinnvoll, da auch zu ungewöhnichen Uhrzeiten Geschäftsfälle registriert werden
* weekdays rausnehmen
* outcome_number raus, da gleich wie income number

```{r}
table(aac_intakes_outcomes2$outcome_number, aac_intakes_outcomes2$intake_number)
```

* age_open_intake, age upon intake year, group raus (da falsche Cluster und unterschiedliche tierarten )

## old

Datetime_Intake -  Geburtsdatum in Tagen - Achtung: negative und Null-Werte vorhanden
```{r, eval=F, echo = F}
aac_in_out$calc_age_in <- round(((aac_in_out$datetime_intake - aac_in_out$date_of_birth)/24/60),0)
```

Folgendes können wir für die Datensätze verwenden, bei denen das Geburtsdatum und datetime_outcome nicht vorhanden ist:
Hier wird die Age-Spalte getrennt und das Alter in Tagen berechnet.

```{r, eval=F, echo = F}
aac_in_out$age_upon_intake_num <- as.numeric(sapply(strsplit(as.character(aac_in_out$age_upon_intake), " "), "[", 1))
aac_in_out$age_upon_intake_char <- sapply(strsplit(as.character(aac_in_out$age_upon_intake), " "), "[", 2)

aac_in_out$age_upon_outcome_num <- as.numeric(sapply(strsplit(as.character(aac_in_out$age_upon_outcome), " "), "[", 1))
aac_in_out$age_upon_outcome_char <- sapply(strsplit(as.character(aac_in_out$age_upon_outcome), " "), "[", 2)

function_age <- function(value){
  if (is.element(value, "years")){
    value <- "365"
  }
  else if (is.element(value, "year")){
    value <- "365"
  }
  else if (is.element(value, "month")){
    value <- "30"
  }
  else if (is.element(value, "months")){
    value <- "30"
  }
  else if (is.element(value, "week")){
    value <- "7"
  }
  else if (is.element(value, "weeks")){
    value <- "7"
  }
  else if (is.element(value, "days")){
    value <- "1"
  }
  else if (is.element(value, "day")){
    value <- "1"
  }
  else if (is.na(value))
    value <- "0" ## ggfs nicht richtig
}

aac_in_out$age_upon_intake_char <- sapply(sapply(aac_in_out$age_upon_intake_char, function_age), as.numeric)
aac_in_out$age_upon_outcome_char <- sapply(sapply(aac_in_out$age_upon_outcome_char, function_age), as.numeric)

aac_in_out$age_upon_intake_calc_days <- aac_in_out$age_upon_intake_char * aac_in_out$age_upon_intake_num
aac_in_out$age_upon_outcome_calc_days <- aac_in_out$age_upon_outcome_char * aac_in_out$age_upon_outcome_num ## geht noch nicht, da NAs

```


